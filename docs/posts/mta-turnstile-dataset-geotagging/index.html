<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>&#39;Sane&#39;itizing MTA&#39;s Turnstile Datasets: Geotagging | Anfernee Jervis</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://ajpen.github.io/css/main.min.07b1a7045f508cd6b0d62564e0fec21e96ab4e6be73c0c9b1c00ab77761ad53e.css"/>

    
    
    

    
    
 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-168989712-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script></head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">Anfernee Jervis</a>
    </div>  
</header>

  <div class="nav-menu">
  
    <a class="color-link nav-link" href="/about/">About</a>
  
    <a class="color-link nav-link" href="/tags/">Tags</a>
  
    <a class="color-link nav-link" href="/archives/">Archives</a>
  
  <a class="color-link nav-link" href="https://ajpen.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        
    <a class="social-icon" href="mailto:anferneejervis@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="https://twitter.com/akjpy592" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://www.linkedin.com/in/anferneejervis" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@ajpen" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/ajpen" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://stackoverflow.com/users/3044418/anfernee" target="_blank" rel="noopener" title="Stack Overflow">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M20.8863636,23.7090909 L20.8863636,17.3818182 L22.9863636,17.3818182 L22.9863636,25.8090909 L4.03181818,25.8090909 L4.03181818,17.3818182 L6.13181818,17.3818182 L6.13181818,23.7090909 L20.8863636,23.7090909 Z M8.45,16.7818182 L8.88636364,14.7090909 L19.1954545,16.8636364 L18.7590909,18.9363636 L8.45,16.7818182 Z M9.81363636,11.8727273 L10.6863636,9.93636364 L20.2318182,14.4090909 L19.3590909,16.3181818 L9.81363636,11.8727273 Z M12.4590909,7.18181818 L13.7954545,5.57272727 L21.8954545,12.3090909 L20.5590909,13.9181818 L12.4590909,7.18181818 Z M17.6954545,2.19090909 L23.9681818,10.6454545 L22.2772727,11.9 L16.0045455,3.44545455 L17.6954545,2.19090909 Z M8.23181818,21.5818182 L8.23181818,19.4818182 L18.7590909,19.4818182 L18.7590909,21.5818182 L8.23181818,21.5818182 Z"></path>
        </svg>
    </a>
    
    
    

    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://ajpen.github.io/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I=" crossorigin="anonymous"></script>
</footer>
</nav>

        <div id="content" class="content-container">
        

<h1 class="post-title">&#39;Sane&#39;itizing MTA&#39;s Turnstile Datasets: Geotagging</h1>
    
    <time>June 16, 2020</time>
    
    <div>
        <p>
        <p><strong>Update:</strong> <a href="https://github.com/chriswhong/nycturnstiles/blob/master/geocoded.csv">Looks like others have geotagged the turnstile dataset too.</a></p>
<h4 id="a-backstory">A Backstory</h4>
<p>in early 2019, I conducted research at BMCC on a noise pollution platform detailing the estimated noise pollution of neighborhoods in NYC (<a href="https://www.microsoft.com/en-us/research/publication/diagnosing-new-york-citys-noises-with-ubiquitous-data/">full paper on the platform here if you&rsquo;re interested</a>). Essentially, the platform inferred the level and type of noise in an area from public ubiquitous datasets using machine learning. After familiarizing myself with the paper, I hypothesized a corelation with noise levels and the number of people within an area at any given time. As you would have guessed, it&rsquo;s not easy to know the exact number of people in a neighborhood at a given time, but given that <a href="https://nytransit.org/resources/public-transit-facts">more than half of NYC uses public transportation</a>, rideship data from the MTA would be helpful for testing my hypothesis. Dealing with the MTA dataset was not fun though.</p>
<h4 id="the-turnstile-dataset">The Turnstile Dataset</h4>
<p>The MTA turnstile dataset is a great asset for many analysis projects (see <a href="https://medium.com/@junyoung_lee/analysis-of-new-york-mta-turnstile-data-95251e212206">this</a> for example), but with a few issues; limited information on column definitions (I googled control area and saw something about airspace??), cumulative data counting backwards unexpectly, weird looking outliers and all sorts of strangeness. Unfortunately, I wasted a lot of time trying to make this dataset somewhat useful (and turns out <a href="https://medium.com/qri-io/taming-the-mtas-unruly-turnstile-data-c945f5f96ba0">I&rsquo;m not</a> the <a href="https://piratefsh.github.io/projects/2015/10/03/mta-subway-turnstile-data.html">only one</a>). Of course I tried googling but, <a href="/posts/scarcity-in-an-ocean-of-knowledge/">you know, scarcity and what not</a>. Anyways, in an attempt to save the next gal/guy from burning hours away trying to tag the station location onto the MTA turnstile dataset, I&rsquo;m sharing this NAAS or <em>notebook-as-a-sitepost</em>. Haha, okay I promise I&rsquo;ll be less cheeky for the rest of the post.</p>
<p>I also would like to experiment creating a pipeline API for processing MTA datasets using some sort of app hosting platform with a free, limited option(like Heroku), to kind of test ways of optimizing for limited resources. A bit like what game developers did with 8 and 16 Bit hardware, but that&rsquo;s for another time.</p>
<h4 id="introducing-the-dataset">Introducing the Dataset</h4>
<p>The turnstile dataset is available for public use at <a href="http://web.mta.info/developers/turnstile.html">http://web.mta.info/developers/turnstile.html</a>. Each dataset contains a week&rsquo;s worth of aggrigated, 4 hour snapshots of the state of a counter within the station turnstiles. Lets briefly look at it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas  <span style="color:#75715e"># Good ol&#39; pandas</span>
<span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
<span style="color:#f92672">import</span> urllib.request
<span style="color:#f92672">from</span> parsel <span style="color:#f92672">import</span> Selector  <span style="color:#75715e"># Scrapy&#39;s parsel makes it easy to select html elements from a web document (https://github.com/scrapy/parsel)</span>



<span style="color:#75715e"># So, this function maps the date of the dataset to the dataset location. </span>
<span style="color:#75715e"># Its not exactly necessary here, but I&#39;m reusing code I already have so bear with me</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_available_datasets</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    fetches links to available datasets from MTA turnstile website.
</span><span style="color:#e6db74">    returns a dict of  date: url pairs.
</span><span style="color:#e6db74">    date format example: Saturday, April 11, 2020
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    MTA_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://web.mta.info/developers/turnstile.html&#39;</span>
    DATA_URL_IDENTIFIER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;data/nyct/turnstile/turnstile_&#39;</span>
    MTA_DOMAIN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://web.mta.info/developers/&#39;</span>

    <span style="color:#66d9ef">with</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(MTA_URL) <span style="color:#66d9ef">as</span> response:
      home_page <span style="color:#f92672">=</span> Selector(response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf8&#34;</span>))

    links <span style="color:#f92672">=</span> home_page<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;//a[contains(@href, &#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;)]&#39;</span><span style="color:#f92672">.</span>format(DATA_URL_IDENTIFIER))
    <span style="color:#66d9ef">return</span> {link<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;text()&#39;</span>)<span style="color:#f92672">.</span>get(): MTA_DOMAIN <span style="color:#f92672">+</span> link<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;@href&#39;</span>)<span style="color:#f92672">.</span>get() <span style="color:#66d9ef">for</span> link <span style="color:#f92672">in</span> links}

  
<span style="color:#75715e"># Okay, let&#39;s pull a dataset and create a dataframe. We&#39;ll use last week&#39;s data (Saturday, June 13, 2020)</span>

url <span style="color:#f92672">=</span> get_available_datasets()[<span style="color:#e6db74">&#39;Saturday, June 13, 2020&#39;</span>]  <span style="color:#75715e"># Ideally, what&#39;s returned from this function should be cached, but it&#39;ll run once so ¯\_(ツ)_/¯</span>

<span style="color:#66d9ef">with</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(url) <span style="color:#66d9ef">as</span> response:
  df <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>read_csv(response)

df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">5</span>)
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C/A</th>
      <th>UNIT</th>
      <th>SCP</th>
      <th>STATION</th>
      <th>LINENAME</th>
      <th>DIVISION</th>
      <th>DATE</th>
      <th>TIME</th>
      <th>DESC</th>
      <th>ENTRIES</th>
      <th>EXITS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>00:00:00</td>
      <td>REGULAR</td>
      <td>7420920</td>
      <td>2521129</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>04:00:00</td>
      <td>REGULAR</td>
      <td>7420920</td>
      <td>2521130</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>08:00:00</td>
      <td>REGULAR</td>
      <td>7420928</td>
      <td>2521141</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>12:00:00</td>
      <td>REGULAR</td>
      <td>7420941</td>
      <td>2521163</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>16:00:00</td>
      <td>REGULAR</td>
      <td>7420972</td>
      <td>2521174</td>
    </tr>
  </tbody>
</table>
</div>
<p>Not bad right? Besides the columns that aren&rsquo;t immediately obvious (C/A, SCP, etc) we can see that the first 4 rows are counts from the 59th ST station. Wait, which station? There&rsquo;s multiple stations at 59 ST in Manhattan.</p>
<p>Well if we look at the stops at that station (represented by the LINENAME column), we can guess that it must be the Lexington Avenue/59th Street station. You can also confirm this by looking for all the stations with 59 ST in the names. You&rsquo;ll see that the one for Columbus Circle says &ldquo;Columbus&rdquo; in its name:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Computer, I command you to give me all the Station names with &#34;59 ST&#34; in them</span>
df[df[<span style="color:#e6db74">&#34;STATION&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>contains(<span style="color:#e6db74">&#34;59 ST&#34;</span>)][<span style="color:#e6db74">&#34;STATION&#34;</span>]<span style="color:#f92672">.</span>unique()
</code></pre></div><pre><code>array(['59 ST', '5 AV/59 ST', '59 ST COLUMBUS'], dtype=object)
</code></pre>
<p>It would&rsquo;ve been nice if it was geotagged though, right?</p>
<p>Yeah?</p>
<p>We&rsquo;ll, lets tag it then.</p>
<p>There&rsquo;s a dataset with latitude/longitude pairs for stations from MTA that we can use to geotag our turnstile datasets. The dataset can be downloaded <a href="http://web.mta.info/developers/data/nyct/subway/Stations.csv">here</a>. Unfortunately, the dataset isn&rsquo;t consistent with the turnstile dataset, and we cannot simply join the two datasets on, say, the name of the station. So we need to seek alternative measures.</p>
<p>The easiest solution I could think of was fuzzy string matching on station names, along with a bit of manual pairing. Using this method, I was able to match most of the stations listed in the turnstile dataset with a corresponding latitude/longitude coordinates. It wasn&rsquo;t easy though and did take a considerable amount of hours.</p>
<p>For explanation sake, I&rsquo;ll briefly take you through that journey. Don&rsquo;t worry, I&rsquo;ll try to make it bearable.</p>
<p>First, lets get the station location dataset I mentioned earlier and take a look:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">with</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;http://web.mta.info/developers/data/nyct/subway/Stations.csv&#34;</span>) <span style="color:#66d9ef">as</span> response:
  stationsdf <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>read_csv(response)

stationsdf<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">5</span>)
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Station ID</th>
      <th>Complex ID</th>
      <th>GTFS Stop ID</th>
      <th>Division</th>
      <th>Line</th>
      <th>Stop Name</th>
      <th>Borough</th>
      <th>Daytime Routes</th>
      <th>Structure</th>
      <th>GTFS Latitude</th>
      <th>GTFS Longitude</th>
      <th>North Direction Label</th>
      <th>South Direction Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>R01</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Astoria - Ditmars Blvd</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.775036</td>
      <td>-73.912034</td>
      <td>NaN</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2</td>
      <td>R03</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Astoria Blvd</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.770258</td>
      <td>-73.917843</td>
      <td>Ditmars Blvd</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3</td>
      <td>R04</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>30 Av</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.766779</td>
      <td>-73.921479</td>
      <td>Astoria - Ditmars Blvd</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>4</td>
      <td>R05</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Broadway</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.761820</td>
      <td>-73.925508</td>
      <td>Astoria - Ditmars Blvd</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>5</td>
      <td>R06</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>36 Av</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.756804</td>
      <td>-73.929575</td>
      <td>Astoria - Ditmars Blvd</td>
      <td>Manhattan</td>
    </tr>
  </tbody>
</table>
</div>
<p>Great, now we have quite a bit of location data for each station. Let&rsquo;s see what shows up when we search for &ldquo;59 st&rdquo; in the stop name. That&rsquo;ll give us an idea of the possibility of joining on stop name/STATION columns:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Computer, I am once again asking you to give me all the Station names with &#34;59 St&#34; in them</span>
stationsdf[stationsdf[<span style="color:#e6db74">&#34;Stop Name&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>contains(<span style="color:#e6db74">&#34;59 St&#34;</span>)]
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Station ID</th>
      <th>Complex ID</th>
      <th>GTFS Stop ID</th>
      <th>Division</th>
      <th>Line</th>
      <th>Stop Name</th>
      <th>Borough</th>
      <th>Daytime Routes</th>
      <th>Structure</th>
      <th>GTFS Latitude</th>
      <th>GTFS Longitude</th>
      <th>North Direction Label</th>
      <th>South Direction Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>613</td>
      <td>R11</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Lexington Av/59 St</td>
      <td>M</td>
      <td>N W R</td>
      <td>Subway</td>
      <td>40.762660</td>
      <td>-73.967258</td>
      <td>Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>8</td>
      <td>R13</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>5 Av/59 St</td>
      <td>M</td>
      <td>N W R</td>
      <td>Subway</td>
      <td>40.764811</td>
      <td>-73.973347</td>
      <td>Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>34</th>
      <td>35</td>
      <td>35</td>
      <td>R41</td>
      <td>BMT</td>
      <td>4th Av</td>
      <td>59 St</td>
      <td>Bk</td>
      <td>N R</td>
      <td>Subway</td>
      <td>40.641362</td>
      <td>-74.017881</td>
      <td>Manhattan</td>
      <td>Coney Island - Bay Ridge</td>
    </tr>
    <tr>
      <th>160</th>
      <td>161</td>
      <td>614</td>
      <td>A24</td>
      <td>IND</td>
      <td>8th Av - Fulton St</td>
      <td>59 St - Columbus Circle</td>
      <td>M</td>
      <td>A B C D</td>
      <td>Subway</td>
      <td>40.768296</td>
      <td>-73.981736</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>315</th>
      <td>315</td>
      <td>614</td>
      <td>125</td>
      <td>IRT</td>
      <td>Broadway - 7Av</td>
      <td>59 St - Columbus Circle</td>
      <td>M</td>
      <td>1</td>
      <td>Subway</td>
      <td>40.768247</td>
      <td>-73.981929</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown</td>
    </tr>
    <tr>
      <th>400</th>
      <td>400</td>
      <td>613</td>
      <td>629</td>
      <td>IRT</td>
      <td>Lexington Av</td>
      <td>59 St</td>
      <td>M</td>
      <td>4 5 6</td>
      <td>Subway</td>
      <td>40.762526</td>
      <td>-73.967967</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
  </tbody>
</table>
</div>
<p>Yikes. Okay. So a couple of issues here (funny thing is, I haven&rsquo;t noticed these issues until I started writing this. Datascience ami right?) The first one is that the names in our location dataset aren&rsquo;t the station names; they&rsquo;re actually the names of the <em>stops</em>. I totally missed that earlier, but fortunately, they line up enough for a lot of the names in the &ldquo;STATION&rdquo; column of our turnstile dataset. We can still use this dataset, but we&rsquo;ll have to do more than just join on &ldquo;STATION&rdquo; and &ldquo;Stop Name&rdquo;.</p>
<p>Okay, lets examine our station/stop locations dataset first. From our example above, we can see that some stations are broken down into multiple stops, with differing line and routes (for example, the first and last rows). What you should also notice is that the complex id is the same for both rows. Coincidence? Well, lets find out: (You&rsquo;d think the station ID would be the same, but nooope. I tried searching for a key for the column names, but found nothing <em>sigh</em>.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># What this one liner does is group the rows by &#34;Complex ID&#34;, filter the groups that have more than one row, </span>
<span style="color:#75715e"># and sort them so we can see the groups next to each other. </span>
stationsdf<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;Complex ID&#39;</span>)<span style="color:#f92672">.</span>filter(<span style="color:#66d9ef">lambda</span> g: len(g) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#34;Complex ID&#34;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Station ID</th>
      <th>Complex ID</th>
      <th>GTFS Stop ID</th>
      <th>Division</th>
      <th>Line</th>
      <th>Stop Name</th>
      <th>Borough</th>
      <th>Daytime Routes</th>
      <th>Structure</th>
      <th>GTFS Latitude</th>
      <th>GTFS Longitude</th>
      <th>North Direction Label</th>
      <th>South Direction Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>174</th>
      <td>174</td>
      <td>636</td>
      <td>A41</td>
      <td>IND</td>
      <td>8th Av - Fulton St</td>
      <td>Jay St - MetroTech</td>
      <td>Bk</td>
      <td>A C F</td>
      <td>Subway</td>
      <td>40.692338</td>
      <td>-73.987342</td>
      <td>Manhattan</td>
      <td>Euclid - Lefferts - Rockaways - Coney Island</td>
    </tr>
    <tr>
      <th>24</th>
      <td>25</td>
      <td>636</td>
      <td>R29</td>
      <td>BMT</td>
      <td>Broadway</td>
      <td>Jay St - MetroTech</td>
      <td>Bk</td>
      <td>R</td>
      <td>Subway</td>
      <td>40.692180</td>
      <td>-73.985942</td>
      <td>Manhattan</td>
      <td>Bay Ridge - 95 St</td>
    </tr>
    <tr>
      <th>330</th>
      <td>330</td>
      <td>635</td>
      <td>142</td>
      <td>IRT</td>
      <td>Broadway - 7Av</td>
      <td>South Ferry</td>
      <td>M</td>
      <td>1</td>
      <td>Subway</td>
      <td>40.702068</td>
      <td>-74.013664</td>
      <td>Uptown &amp; The Bronx</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>635</td>
      <td>R27</td>
      <td>BMT</td>
      <td>Broadway</td>
      <td>Whitehall St</td>
      <td>M</td>
      <td>R W</td>
      <td>Subway</td>
      <td>40.703087</td>
      <td>-74.012994</td>
      <td>Uptown &amp; Queens</td>
      <td>Brooklyn</td>
    </tr>
    <tr>
      <th>127</th>
      <td>128</td>
      <td>630</td>
      <td>L17</td>
      <td>BMT</td>
      <td>Canarsie</td>
      <td>Myrtle - Wyckoff Avs</td>
      <td>Bk</td>
      <td>L</td>
      <td>Subway</td>
      <td>40.699814</td>
      <td>-73.911586</td>
      <td>Manhattan</td>
      <td>Canarsie - Rockaway Parkway</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>462</th>
      <td>461</td>
      <td>461</td>
      <td>R09</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Queensboro Plaza</td>
      <td>Q</td>
      <td>N W</td>
      <td>Elevated</td>
      <td>40.750582</td>
      <td>-73.940202</td>
      <td>Astoria - Flushing</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>166</th>
      <td>167</td>
      <td>167</td>
      <td>A32</td>
      <td>IND</td>
      <td>8th Av - Fulton St</td>
      <td>W 4 St</td>
      <td>M</td>
      <td>A C E</td>
      <td>Subway</td>
      <td>40.732338</td>
      <td>-74.000495</td>
      <td>Uptown - Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>167</th>
      <td>167</td>
      <td>167</td>
      <td>D20</td>
      <td>IND</td>
      <td>6th Av - Culver</td>
      <td>W 4 St</td>
      <td>M</td>
      <td>B D F M</td>
      <td>Subway</td>
      <td>40.732338</td>
      <td>-74.000495</td>
      <td>Uptown - Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>149</th>
      <td>151</td>
      <td>151</td>
      <td>A12</td>
      <td>IND</td>
      <td>8th Av - Fulton St</td>
      <td>145 St</td>
      <td>M</td>
      <td>A C</td>
      <td>Subway</td>
      <td>40.824783</td>
      <td>-73.944216</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>150</th>
      <td>151</td>
      <td>151</td>
      <td>D13</td>
      <td>IND</td>
      <td>Concourse</td>
      <td>145 St</td>
      <td>M</td>
      <td>B D</td>
      <td>Subway</td>
      <td>40.824783</td>
      <td>-73.944216</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
  </tbody>
</table>
<p>86 rows × 13 columns</p>
</div>
<p>Okay. Lets take some samples and test. We&rsquo;ve already seen for Lexington Av/59th St that the &ldquo;Daytime Routes&rdquo; (AKA trains that run there) mostly add up to the &ldquo;LINENAME&rdquo; in our turnstile dataset (except for the Q train, which I assume is there because of the access to the Lexington Av/63rd St Station, which runs the Q train. There also was a substitution of the Q for the W from 2010-2016. <a href="https://en.wikipedia.org/wiki/Lexington_Avenue/59th_Street_station">details here if you&rsquo;re interested</a>). Let&rsquo;s try rows 3 &amp; 4; Whitehall St and South Ferry. If you add the &ldquo;Daytime Routes&rdquo;, you&rsquo;ll see it corresponds with the &ldquo;LINENAME&rdquo; values for &ldquo;SOUTH FERRY&rdquo; in the turnstile dataset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[df[<span style="color:#e6db74">&#34;STATION&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;SOUTH FERRY&#34;</span>]<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">1</span>) 
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C/A</th>
      <th>UNIT</th>
      <th>SCP</th>
      <th>STATION</th>
      <th>LINENAME</th>
      <th>DIVISION</th>
      <th>DATE</th>
      <th>TIME</th>
      <th>DESC</th>
      <th>ENTRIES</th>
      <th>EXITS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>128358</th>
      <td>R101</td>
      <td>R001</td>
      <td>02-00-00</td>
      <td>SOUTH FERRY</td>
      <td>1RW</td>
      <td>IRT</td>
      <td>06/06/2020</td>
      <td>01:00:00</td>
      <td>REGULAR</td>
      <td>7025506</td>
      <td>283662</td>
    </tr>
  </tbody>
</table>
</div>
<p>Great. So maybe we can use the LINENAME/Daytime Routes to geotag the turnstile dataset.</p>
<p>Lets try it.</p>
<p>First, I&rsquo;ll try to consolidate the &ldquo;Daytime Routes&rdquo; for the stops stops that are in the same station, and replace the &ldquo;Daytime Routes&rdquo; for each with the consolidated value. Afterward, we&rsquo;ll check Lex av/59th and South Ferry/Whitehall:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># this needs to run ONLY ONCE or you&#39;ll get the world of duplicates</span>
stationsdf[<span style="color:#e6db74">&#34;Daytime Routes&#34;</span>] <span style="color:#f92672">=</span> stationsdf[[<span style="color:#e6db74">&#34;Complex ID&#34;</span>,<span style="color:#e6db74">&#34;Daytime Routes&#34;</span>]]<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;Complex ID&#34;</span>)[<span style="color:#e6db74">&#34;Daytime Routes&#34;</span>]<span style="color:#f92672">.</span>transform(<span style="color:#66d9ef">lambda</span> x: <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([y<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> x]))
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Check Lex av/59th</span>
stationsdf[stationsdf[<span style="color:#e6db74">&#34;Stop Name&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>contains(<span style="color:#e6db74">&#34;59 St&#34;</span>)]
</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Station ID</th>
      <th>Complex ID</th>
      <th>GTFS Stop ID</th>
      <th>Division</th>
      <th>Line</th>
      <th>Stop Name</th>
      <th>Borough</th>
      <th>Daytime Routes</th>
      <th>Structure</th>
      <th>GTFS Latitude</th>
      <th>GTFS Longitude</th>
      <th>North Direction Label</th>
      <th>South Direction Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>613</td>
      <td>R11</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>Lexington Av/59 St</td>
      <td>M</td>
      <td>NWR456</td>
      <td>Subway</td>
      <td>40.762660</td>
      <td>-73.967258</td>
      <td>Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>8</td>
      <td>R13</td>
      <td>BMT</td>
      <td>Astoria</td>
      <td>5 Av/59 St</td>
      <td>M</td>
      <td>NWR</td>
      <td>Subway</td>
      <td>40.764811</td>
      <td>-73.973347</td>
      <td>Queens</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>34</th>
      <td>35</td>
      <td>35</td>
      <td>R41</td>
      <td>BMT</td>
      <td>4th Av</td>
      <td>59 St</td>
      <td>Bk</td>
      <td>NR</td>
      <td>Subway</td>
      <td>40.641362</td>
      <td>-74.017881</td>
      <td>Manhattan</td>
      <td>Coney Island - Bay Ridge</td>
    </tr>
    <tr>
      <th>160</th>
      <td>161</td>
      <td>614</td>
      <td>A24</td>
      <td>IND</td>
      <td>8th Av - Fulton St</td>
      <td>59 St - Columbus Circle</td>
      <td>M</td>
      <td>ABCD1</td>
      <td>Subway</td>
      <td>40.768296</td>
      <td>-73.981736</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
    <tr>
      <th>315</th>
      <td>315</td>
      <td>614</td>
      <td>125</td>
      <td>IRT</td>
      <td>Broadway - 7Av</td>
      <td>59 St - Columbus Circle</td>
      <td>M</td>
      <td>ABCD1</td>
      <td>Subway</td>
      <td>40.768247</td>
      <td>-73.981929</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown</td>
    </tr>
    <tr>
      <th>400</th>
      <td>400</td>
      <td>613</td>
      <td>629</td>
      <td>IRT</td>
      <td>Lexington Av</td>
      <td>59 St</td>
      <td>M</td>
      <td>NWR456</td>
      <td>Subway</td>
      <td>40.762526</td>
      <td>-73.967967</td>
      <td>Uptown &amp; The Bronx</td>
      <td>Downtown &amp; Brooklyn</td>
    </tr>
  </tbody>
</table>
</div>
<p>Great. Now let&rsquo;s see if we can get somewhere with this. We know we can&rsquo;t directly join because the stations don&rsquo;t have the exact names. The next best thing is to fuzzy search. We&rsquo;ll use fuzzywuzzy to do the fuzzy matching, so now we need a strategy to ensure our dataset is as accurate as possible.</p>
<p>The easiest strategy I can think of is to match the names first then match the Routes and assume the highest pair is correct (we&rsquo;ll test of course). With this in mind, I can match the closest name with routes that are essentially the same thing.</p>
<p>Lets see how that plays out:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> fuzzywuzzy <span style="color:#f92672">import</span> process, fuzz
<span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> itemgetter


station_stops <span style="color:#f92672">=</span> {x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>): x[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> zip(stationsdf[<span style="color:#e6db74">&#34;Stop Name&#34;</span>])}

station_stop_names <span style="color:#f92672">=</span> station_stops<span style="color:#f92672">.</span>keys()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">match_records</span>(row):
  <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">  Receives a unique (STATION, LINENAME) row from the turnstile dataset and attempts to match it with a record
</span><span style="color:#e6db74">  from the stop/station location dataset using the names and Routes.
</span><span style="color:#e6db74">  
</span><span style="color:#e6db74">  The function runs fuzzy search on the station name and the linename/routes and aggregates the results.
</span><span style="color:#e6db74">  Then it sorts the results in descending order by the match ratio of the name first, then the linename/route.
</span><span style="color:#e6db74">  Finally, it returns the result with the highest name and line/route match ratio
</span><span style="color:#e6db74">  
</span><span style="color:#e6db74">  Returns a dictionary in the format 
</span><span style="color:#e6db74">    {&#39;station&#39;: &#39;59 ST&#39;,        == Corresponds to the STATION column in the turnstile dataset
</span><span style="color:#e6db74">   &#39;name_match&#39;: (&#39;59St&#39;, 100), == Corresponds to the matched stop name keys &amp; the match ratio
</span><span style="color:#e6db74">   &#39;line_match&#39;: &#39;NWR456&#39;,      == Corresponds to the lines/Routes 
</span><span style="color:#e6db74">   &#39;stop_name_match&#39;: &#39;59 St&#39;,  == Corresponds to the actual, unmodified stop name
</span><span style="color:#e6db74">   &#39;line_fuzz_ratio&#39;: 77}       == Corresponds to the match ratio of the Routes with that of the LINENAME From the
</span><span style="color:#e6db74">                                   turnstile dataset 
</span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
  
  <span style="color:#75715e"># preprocess the station name to increase the accuracy of fuzzy matching</span>
  station_name <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#34;STATION&#34;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
  
  station_routes <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#34;LINENAME&#34;</span>]
  
  <span style="color:#75715e"># first, get the potential matches. </span>
  candidates <span style="color:#f92672">=</span> process<span style="color:#f92672">.</span>extract(station_name, 
                               station_stop_names, scorer<span style="color:#f92672">=</span>fuzz<span style="color:#f92672">.</span>token_sort_ratio, limit<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
  
  
  <span style="color:#75715e"># stores the results of all the line matches for each name match </span>
  records <span style="color:#f92672">=</span> []
 
  <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> candidates:
    
    <span style="color:#75715e"># Find corresponding record(s) from the station locations dataframe </span>
    candidate_match <span style="color:#f92672">=</span> stationsdf[stationsdf[<span style="color:#e6db74">&#34;Stop Name&#34;</span>] <span style="color:#f92672">==</span> station_stops[x[<span style="color:#ae81ff">0</span>]]][<span style="color:#e6db74">&#34;Daytime Routes&#34;</span>]<span style="color:#f92672">.</span>unique()
    
    <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> candidate_match:
      records<span style="color:#f92672">.</span>append({
        <span style="color:#e6db74">&#34;station&#34;</span>: row[<span style="color:#e6db74">&#34;STATION&#34;</span>],
        <span style="color:#e6db74">&#34;name_match&#34;</span>: x,
        <span style="color:#e6db74">&#34;line_match&#34;</span>: y,
        <span style="color:#e6db74">&#34;station_line&#34;</span>: station_routes,
        <span style="color:#e6db74">&#34;stop_name_match&#34;</span>: station_stops[x[<span style="color:#ae81ff">0</span>]],
        <span style="color:#e6db74">&#34;line_fuzz_ratio&#34;</span>: fuzz<span style="color:#f92672">.</span>token_sort_ratio(station_routes, y)
      })
  
  <span style="color:#75715e"># sorts the results by name first, line/route second, in descending order, and returns the first result</span>
  <span style="color:#66d9ef">return</span> sorted(records, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: (x[<span style="color:#e6db74">&#34;name_match&#34;</span>][<span style="color:#ae81ff">1</span>], x[<span style="color:#e6db74">&#34;line_fuzz_ratio&#34;</span>]), reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)[<span style="color:#ae81ff">0</span>]

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Now we apply the function to our dataframes</span>
results <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;STATION&#39;</span>,<span style="color:#e6db74">&#39;LINENAME&#39;</span>]]<span style="color:#f92672">.</span>drop_duplicates()<span style="color:#f92672">.</span>reset_index()<span style="color:#f92672">.</span>apply(match_records, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><p>Okay we&rsquo;re close! There are a couple of stations that aren&rsquo;t matching correctly, or don&rsquo;t exist in your locations dataset. We&rsquo;ll have to do some manual vetting to take care of those (don&rsquo;t worry, I did it myself.)</p>
<p>Now, lets clean our data, fix the wrong matches, and use the mapping to geotag the turnstile dataset.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Here&#39;s a list of items that weren&#39;t a perfect match for both station names and routes *surpressed to the first 2* </span>
<span style="color:#75715e"># We&#39;ll review these and remove the ones we cant fix, or update the mismatches</span>
[x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> results <span style="color:#66d9ef">if</span> x[<span style="color:#e6db74">&#39;line_fuzz_ratio&#39;</span>] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">and</span> x[<span style="color:#e6db74">&#34;name_match&#34;</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>][:<span style="color:#ae81ff">2</span>]
</code></pre></div><pre><code>[{'station': 'WHITEHALL S-FRY',
  'name_match': ('WhitehallSt', 83),
  'line_match': 'RW1',
  'station_line': 'R1W',
  'stop_name_match': 'Whitehall St',
  'line_fuzz_ratio': 67},
 {'station': 'DELANCEY/ESSEX',
  'name_match': ('DelanceySt', 75),
  'line_match': 'JMZF',
  'station_line': 'FJMZ',
  'stop_name_match': 'Delancey St',
  'line_fuzz_ratio': 75}]
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Fixed missed matches here:</span>
<span style="color:#75715e"># the patched key is there to identify records that were manually corrected</span>
mismatches <span style="color:#f92672">=</span> {
 <span style="color:#e6db74">&#39;FLATBUSH AV-B.C&#39;</span>: {<span style="color:#e6db74">&#39;station&#39;</span>: <span style="color:#e6db74">&#39;FLATBUSH AV-B.C&#39;</span>,
  <span style="color:#e6db74">&#39;name_match&#39;</span>: (<span style="color:#e6db74">&#39;Flatbush Av - Brooklyn College&#39;</span>, <span style="color:#ae81ff">61</span>),
  <span style="color:#e6db74">&#39;line_match&#39;</span>: <span style="color:#e6db74">&#39;25&#39;</span>,
  <span style="color:#e6db74">&#39;station_line&#39;</span>: <span style="color:#e6db74">&#39;25&#39;</span>,
  <span style="color:#e6db74">&#39;stop_name_match&#39;</span>: <span style="color:#e6db74">&#39;Flatbush Av - Brooklyn College&#39;</span>,
  <span style="color:#e6db74">&#39;line_fuzz_ratio&#39;</span>: <span style="color:#ae81ff">100</span>,
  <span style="color:#e6db74">&#39;patched&#39;</span>: <span style="color:#66d9ef">True</span>},
  
  <span style="color:#e6db74">&#39;ROCKAWAY PARK B&#39;</span>: {<span style="color:#e6db74">&#39;station&#39;</span>: <span style="color:#e6db74">&#39;ROCKAWAY PARK B&#39;</span>,
  <span style="color:#e6db74">&#39;name_match&#39;</span>: (<span style="color:#e6db74">&#39;RockawayParkBeach116St&#39;</span>, <span style="color:#ae81ff">100</span>),
  <span style="color:#e6db74">&#39;line_match&#39;</span>: <span style="color:#e6db74">&#39;AS&#39;</span>,
  <span style="color:#e6db74">&#39;station_line&#39;</span>: <span style="color:#e6db74">&#39;AS&#39;</span>,
  <span style="color:#e6db74">&#39;stop_name_match&#39;</span>: <span style="color:#e6db74">&#39;Rockaway Park - Beach 116 St&#39;</span>,
  <span style="color:#e6db74">&#39;line_fuzz_ratio&#39;</span>: <span style="color:#ae81ff">100</span>,
  <span style="color:#e6db74">&#39;patched&#39;</span>: <span style="color:#66d9ef">True</span>},
<span style="color:#75715e"># ... surpressed</span>
}

  <span style="color:#75715e"># The location of these aren&#39;t in the dataset, so we&#39;ll ignore them. </span>
  <span style="color:#75715e"># I don&#39;t know what some of the names correspond to either </span>
unknowns <span style="color:#f92672">=</span> [
  <span style="color:#e6db74">&#34;RIT-ROOSEVELT&#34;</span>,
  <span style="color:#e6db74">&#34;RIT-MANHATTAN&#34;</span>,
  <span style="color:#e6db74">&#34;ST. GEORGE&#34;</span>,
  <span style="color:#e6db74">&#34;ORCHARD BEACH&#34;</span>,
  <span style="color:#e6db74">&#34;NEWARK HW BMEBE&#34;</span>,
  <span style="color:#e6db74">&#34;HARRISON&#34;</span>,
  <span style="color:#e6db74">&#34;JOURNAL SQUARE&#34;</span>,
  <span style="color:#e6db74">&#39;EXCHANGE PLACE&#39;</span>,
  <span style="color:#e6db74">&#39;PAVONIA/NEWPORT&#39;</span>,
  <span style="color:#e6db74">&#39;CITY / BUS&#39;</span>,
  <span style="color:#75715e"># ... surpressed</span>
]
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Lets now filter the unknowns and fix the mismatches</span>
results_filtered <span style="color:#f92672">=</span> [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> results <span style="color:#66d9ef">if</span> x[<span style="color:#e6db74">&#39;station&#39;</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> unknowns]

<span style="color:#75715e"># and also, fix the mismatches</span>
results_fixed <span style="color:#f92672">=</span> [mismatches[x[<span style="color:#e6db74">&#39;station&#39;</span>]] <span style="color:#66d9ef">if</span> mismatches<span style="color:#f92672">.</span>get(x[<span style="color:#e6db74">&#39;station&#39;</span>], <span style="color:#66d9ef">None</span>) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#66d9ef">else</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> results_filtered]
</code></pre></div><p>Alright, now its time to geotag each record. To do so, I&rsquo;ll map station names and routes to a particular location, then later use that to update the turnstile records</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># maps the station and line to the geolocations</span>

_ <span style="color:#f92672">=</span> [
  x<span style="color:#f92672">.</span>update(
    stationsdf[
      (stationsdf[<span style="color:#e6db74">&#34;Stop Name&#34;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#34;stop_name_match&#34;</span>]) <span style="color:#f92672">&amp;</span> 
      (stationsdf[<span style="color:#e6db74">&#34;Daytime Routes&#34;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#34;line_match&#34;</span>])
    ]
    [[<span style="color:#e6db74">&#34;GTFS Latitude&#34;</span>, <span style="color:#e6db74">&#34;GTFS Longitude&#34;</span>]]<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>to_dict(<span style="color:#e6db74">&#39;list&#39;</span>)
  ) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> results_fixed]

<span style="color:#75715e"># Some records have the lat/long values in a list (like [40.824073] for example). the lines below fixes that</span>
_ <span style="color:#f92672">=</span> [
  x<span style="color:#f92672">.</span>update(
    {<span style="color:#e6db74">&#39;GTFS Latitude&#39;</span>: x[<span style="color:#e6db74">&#39;GTFS Latitude&#39;</span>][<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">if</span> type(x[<span style="color:#e6db74">&#39;GTFS Latitude&#39;</span>]) <span style="color:#f92672">is</span> list <span style="color:#66d9ef">else</span> x, 
     <span style="color:#e6db74">&#39;GTFS Longitude&#39;</span>: x[<span style="color:#e6db74">&#39;GTFS Longitude&#39;</span>][<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">if</span> type(x[<span style="color:#e6db74">&#39;GTFS Longitude&#39;</span>]) <span style="color:#f92672">is</span> list <span style="color:#66d9ef">else</span> x}
  ) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> results_fixed]


<span style="color:#75715e"># I&#39;ll convert it into a df, then use &#39;station&#39; and &#39;station_line&#39; to join it on the turnstile dataset</span>
mappingdf <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame(results_fixed)<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;name_match&#39;</span>, <span style="color:#e6db74">&#39;line_match&#39;</span>, <span style="color:#e6db74">&#39;stop_name_match&#39;</span>, <span style="color:#e6db74">&#39;line_fuzz_ratio&#39;</span>, <span style="color:#e6db74">&#39;patched&#39;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
pandas<span style="color:#f92672">.</span>merge(df, mappingdf, left_on<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;STATION&#39;</span>, <span style="color:#e6db74">&#39;LINENAME&#39;</span>], right_on<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;station&#39;</span>, <span style="color:#e6db74">&#39;station_line&#39;</span>], how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>)

</code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C/A</th>
      <th>UNIT</th>
      <th>SCP</th>
      <th>STATION</th>
      <th>LINENAME</th>
      <th>DIVISION</th>
      <th>DATE</th>
      <th>TIME</th>
      <th>DESC</th>
      <th>ENTRIES</th>
      <th>EXITS</th>
      <th>station</th>
      <th>station_line</th>
      <th>GTFS Latitude</th>
      <th>GTFS Longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>00:00:00</td>
      <td>REGULAR</td>
      <td>7420920</td>
      <td>2521129</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>40.762526</td>
      <td>-73.967967</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>04:00:00</td>
      <td>REGULAR</td>
      <td>7420920</td>
      <td>2521130</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>40.762526</td>
      <td>-73.967967</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>08:00:00</td>
      <td>REGULAR</td>
      <td>7420928</td>
      <td>2521141</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>40.762526</td>
      <td>-73.967967</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>12:00:00</td>
      <td>REGULAR</td>
      <td>7420941</td>
      <td>2521163</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>40.762526</td>
      <td>-73.967967</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A002</td>
      <td>R051</td>
      <td>02-00-00</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>BMT</td>
      <td>06/06/2020</td>
      <td>16:00:00</td>
      <td>REGULAR</td>
      <td>7420972</td>
      <td>2521174</td>
      <td>59 ST</td>
      <td>NQR456W</td>
      <td>40.762526</td>
      <td>-73.967967</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>206657</th>
      <td>TRAM2</td>
      <td>R469</td>
      <td>00-05-01</td>
      <td>RIT-ROOSEVELT</td>
      <td>R</td>
      <td>RIT</td>
      <td>06/12/2020</td>
      <td>05:00:00</td>
      <td>REGULAR</td>
      <td>5554</td>
      <td>514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>206658</th>
      <td>TRAM2</td>
      <td>R469</td>
      <td>00-05-01</td>
      <td>RIT-ROOSEVELT</td>
      <td>R</td>
      <td>RIT</td>
      <td>06/12/2020</td>
      <td>09:00:00</td>
      <td>REGULAR</td>
      <td>5554</td>
      <td>514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>206659</th>
      <td>TRAM2</td>
      <td>R469</td>
      <td>00-05-01</td>
      <td>RIT-ROOSEVELT</td>
      <td>R</td>
      <td>RIT</td>
      <td>06/12/2020</td>
      <td>13:00:00</td>
      <td>REGULAR</td>
      <td>5554</td>
      <td>514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>206660</th>
      <td>TRAM2</td>
      <td>R469</td>
      <td>00-05-01</td>
      <td>RIT-ROOSEVELT</td>
      <td>R</td>
      <td>RIT</td>
      <td>06/12/2020</td>
      <td>17:00:00</td>
      <td>REGULAR</td>
      <td>5554</td>
      <td>514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>206661</th>
      <td>TRAM2</td>
      <td>R469</td>
      <td>00-05-01</td>
      <td>RIT-ROOSEVELT</td>
      <td>R</td>
      <td>RIT</td>
      <td>06/12/2020</td>
      <td>21:00:00</td>
      <td>REGULAR</td>
      <td>5554</td>
      <td>514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>206662 rows × 15 columns</p>
</div>
<p>Done! We&rsquo;re all geotagged now!</p>
<h4 id="imrovements-and-contributions-welcomed">Imrovements and Contributions Welcomed!</h4>
<p>I&rsquo;ll have the code and dataset available <a href="https://github.com/ajpen/MTA-Station-Geo-Location-Mapping">here</a>. Feel free to open issues and PRs for fixes/improvements.</p>
<p>That is all.</p>

        </p>
    </div>
    

    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="/tags/mta-turnstile-dataset-series">#MTA Turnstile Dataset Series</a>
        
            <a class="tag" href="/tags/geotagging">#Geotagging</a>
        
            <a class="tag" href="/tags/mta">#MTA</a>
        
            <a class="tag" href="/tags/datasets">#Datasets</a>
        
            <a class="tag" href="/tags/data-mining">#Data Mining</a>
        
            <a class="tag" href="/tags/web-scraping">#Web Scraping</a>
        
            <a class="tag" href="/tags/pandas">#Pandas</a>
        
      
    </div>


        

<link rel="stylesheet" type="text/css" href="/css/katex.min.css" crossorigin="anonymous">
<script type="text/javascript" src="/js/katex.min.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/auto-render.min.js"onload="renderMathInElement(document.body);" crossorigin="anonymous"></script>

        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        
    <a class="social-icon" href="mailto:anferneejervis@gmail.com" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    

    
    <a class="social-icon" href="https://twitter.com/akjpy592" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://www.linkedin.com/in/anferneejervis" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@ajpen" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/ajpen" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://stackoverflow.com/users/3044418/anfernee" target="_blank" rel="noopener" title="Stack Overflow">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M20.8863636,23.7090909 L20.8863636,17.3818182 L22.9863636,17.3818182 L22.9863636,25.8090909 L4.03181818,25.8090909 L4.03181818,17.3818182 L6.13181818,17.3818182 L6.13181818,23.7090909 L20.8863636,23.7090909 Z M8.45,16.7818182 L8.88636364,14.7090909 L19.1954545,16.8636364 L18.7590909,18.9363636 L8.45,16.7818182 Z M9.81363636,11.8727273 L10.6863636,9.93636364 L20.2318182,14.4090909 L19.3590909,16.3181818 L9.81363636,11.8727273 Z M12.4590909,7.18181818 L13.7954545,5.57272727 L21.8954545,12.3090909 L20.5590909,13.9181818 L12.4590909,7.18181818 Z M17.6954545,2.19090909 L23.9681818,10.6454545 L22.2772727,11.9 L16.0045455,3.44545455 L17.6954545,2.19090909 Z M8.23181818,21.5818182 L8.23181818,19.4818182 L18.7590909,19.4818182 L18.7590909,21.5818182 L8.23181818,21.5818182 Z"></path>
        </svg>
    </a>
    
    
    

    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://ajpen.github.io/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I=" crossorigin="anonymous"></script>
</footer>
    </body>
</html>